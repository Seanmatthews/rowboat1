machine:
  services:
    - docker

  environment:
    DOCKER_EMAIL: foo@rat.org
    DOCKER_USERNAME: rowboat
    secure: K8IVz8EbP0ODzrlN6SoBjdbJRPGl6+dUF5YLG0T9kHRMbxRQlaPxiY/tkIOYhn770UKiYLXhb91149VjNa0ph/zxleMFbdjXZUgeFr9mjQeDMAi4X9xSv1dN1GFUYO3jz4yvOJqGc7qROY2pGaVsj+AOOweXVSI1F9jbn6SXaSsTUQB+3VC5vh+uNXKAEmctHB8JUlqO1ixg9V2uT3aLwu1hek6FaDFyluqMBawUbwzyxbMK1/LcnOU67ln4XCR/t+E06GTKVSJN95ZenGtCw+ML3mH7bNgGvmf5HtJo1MxnmG9f1FI6Qy7T1frGx41ImqlZ5jk5b+uVS0QGiYM68cGtCpwFjXxl7gzIMdayZFQoI0mzheAw+7Vd2eRiRMDCecVXEy7Oj9BxDKXHvmDdlkf9XHDOgnG4nNSHiUQ6a8eFdRnyscilGPQgHrvsOyKnvcizJ3hXDU9zxkHmQmbUfIvjy9gBJwlFDa4GFomiwct1qU0NAtZZ8QECWQOvXHAfvHbAT9bUP2eYU5LG6YZ7YPGsYpkooaWfrm1qsg3UA/n5KyDS3Yeq/6whpm91Jl70LbdT/TJegMX0sTf2R+538vEnmoaqsS1af6MCRhvYyY4KQH7PMvcIJrIhjEeKtHKrhiNYz0YThnIgE5vpaJ4uuJ0eYWhRwGqibPb/5qCucrI=OB

checkout:
  post:
    - git submodule sync
    - git submodule update --init

# https://github.com/philipz/docker-arm-circleci/blob/master/circle.yml
dependencies:
  pre:
    - sudo apt-get update
    - sudo cp ./qemu-arm-static /usr/bin
    - sudo cp ./qemu-arm /usr/share/binfmts/
    - qemu-arm-static -version
  override:
    - docker info
    - docker pull ubergarm/armhf-ubuntu:trusty
    - docker run --name rowboat-test --rm -it -v /usr/bin/qemu-arm-static:/usr/bin/qemu-arm-static ubergarm/armhf-ubuntu:trusty sh -c 'apt-get update && apt-get install -y --no-install-recommendds mosquitto-clients'
    - docker commit rowboat-test rowboat/rowboat1

test:
  override:
    - docker run --rm -it ubergarm/armhf-ubuntu:trusty uname -a
#    - curl --retry 10 --retry-delay 5 -v http://localhost:9200

deployment:
  hub:
    branch: master
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
      - docker push rowboat/rowboat1