machine:
  services:
    - docker

  environment:
    DOCKER_EMAIL: foo@rat.org
    DOCKER_USERNAME: rowboat
    secure: K8IVz8EbP0ODzrlN6SoBjdbJRPGl6+dUF5YLG0T9kHRMbxRQlaPxiY/tkIOYhn770UKiYLXhb91149VjNa0ph/zxleMFbdjXZUgeFr9mjQeDMAi4X9xSv1dN1GFUYO3jz4yvOJqGc7qROY2pGaVsj+AOOweXVSI1F9jbn6SXaSsTUQB+3VC5vh+uNXKAEmctHB8JUlqO1ixg9V2uT3aLwu1hek6FaDFyluqMBawUbwzyxbMK1/LcnOU67ln4XCR/t+E06GTKVSJN95ZenGtCw+ML3mH7bNgGvmf5HtJo1MxnmG9f1FI6Qy7T1frGx41ImqlZ5jk5b+uVS0QGiYM68cGtCpwFjXxl7gzIMdayZFQoI0mzheAw+7Vd2eRiRMDCecVXEy7Oj9BxDKXHvmDdlkf9XHDOgnG4nNSHiUQ6a8eFdRnyscilGPQgHrvsOyKnvcizJ3hXDU9zxkHmQmbUfIvjy9gBJwlFDa4GFomiwct1qU0NAtZZ8QECWQOvXHAfvHbAT9bUP2eYU5LG6YZ7YPGsYpkooaWfrm1qsg3UA/n5KyDS3Yeq/6whpm91Jl70LbdT/TJegMX0sTf2R+538vEnmoaqsS1af6MCRhvYyY4KQH7PMvcIJrIhjEeKtHKrhiNYz0YThnIgE5vpaJ4uuJ0eYWhRwGqibPb/5qCucrI=OB

checkout:
  post:
    - git submodule sync
    - git submodule update --init

dependencies:
  override:
    - docker info
    - docker pull rowboat/rowboat-base-images:1.0

test:
  override:
    - docker run --name container -it -v $HOME:/tmp rowboat/rowboat-base-images:1.0 /bin/bash -c "source /opt/ros/indigo/setup.bash; cp -R /tmp/rowboat1 .; catkin build -w /root/rowboat1 --no-notify --no-status"
        timeout: 1200

deployment:
  hub:
    branch: master
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
      - docker tag newCont rowboat/rowboat1-tested-build:$TRAVIS_BRANCH$TRAVIS_BUILD_NUMBER
      - docker push rowboat/rowboat1-tested-build
      - docker search rowboat/rowboat1-tested-build:$TRAVIS_BRANCH$TRAVIS_BUILD_NUMBER